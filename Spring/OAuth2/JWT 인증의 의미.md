# JWT 인증의 의미
2022/07/18

## 1. 포스팅 이유
refresh token 을 사용하는 이유가 무엇이고, refresh token 을 서버가 아닌 쿠키에 저장할려는 이유가 무엇일까? 개발 구현을 하고 역으로 의문점을 해결해나가고 있다.

## 2. 토큰 기반 인증 시스템을 선택하는 이유
1. Stateless 서버
- Stateful 서버 
  - 클라이언트에게서 요청을 받을 때 마다, 클라이언트의 상태를 계속해서 유지하고, 이 정보를 서비스 제공에 이용
    - 예) 세션을 유지하는 웹서버 : 로그인 정보를 세션에 저장
- Stateless 서버
  - 상태정보를 저장하지 않으면, 서버는 클라이언트측에서 들어오는 요청만으로만 작업을 처리합니다.
  - 상태가 없는 경우 클라이언트와 서버의 연결고리가 없기 때문에 서버의 확장성 (Scalability) 이 높다

2. 보안
- 토큰 기반 인증 시스템을 사용하여 어플리케이션의 보안을 높일 수 있다.

3. 백엔드 부하
- 세션을 이용해 서버에 인증기록을 하는 경우 유저수가 늘어나면 서버의 램에 과부하 발생
- db 에 저장하는 경우 유저수 증가에 따른 db 성능 문제 발생가능

4. 확장성
- 세션을 사용하면 서버를 확장하는것이 어려워진다
- 서버의 확장이란 더 많은 트래픽을 감당하기 위하여 여러개의 프로세스를 돌리거나, 여러대의 서버 컴퓨터를 추가 하는것을 의미한다
- 세션을 사용하면서 분산된 시스템을 설계하는건 불가능한것은 아니지만 과정이 매우 복잡하다
  - 서버를 여러대를 사용하여 요청을 분산하였다면, 어떤 유저가 로그인 했을땐, 그 유저는 처음 로그인했었던 그 서버에만 요청을 보내도록 설정을 해야한다.

5. CORS
- 세션을 관리 할 때 자주 사용되는 쿠키는 단일 도메인 및 서브 도메인에서만 작동하도록 설계되어있다.
- 쿠키를 여러 도메인에서 관리하는것은 좀 번거롭다.
- CORS 설정 필요

## 3, 토큰 기반 시스템 동작 방식
- 토큰 기반 시스템은 stateless하다
- 유저의 인증 정보를 서버나 세션에 담아두지 않는다.(확장성측면에서 유리)
1. 유저가 아이디와 비밀번호로 로그인을 합니다
2. 서버측에서 해당 계정정보를 검증합니다.
3. 계정정보가 정확하다면, 서버측에서 유저에게 signed 토큰을 발급해줍니다.
4. 여기서 signed 의 의미는 해당 토큰이 서버에서 정상적으로 발급된 토큰임을 증명하는 signature 를 지니고 있다는 것입니다
5. 클라이언트 측에서 전달받은 토큰을 저장해두고, 서버에 요청을 할 때 마다, 해당 토큰을 함께 서버에 전달합니다.
6. 서버는 토큰을 검증하고, 요청에 응답합니다.

## 4. 토큰의 장점
- 무상태(stateless) 이며 확장성(scalability)이 있다
- 보안성
  - 쿠키를 전달하지 않음으로 쿠키를 사용함으로 인해 발생하는 취약점이 사라진다.
- Extensibility (확장성)
  - 로그인 정보가 사용되는 분야를 확장하는것을 의미
  - 토큰을 사용하여 다른 서비스에서도 권한을 공유 할 수 있다.
- 여러 플랫폼 및 도메인
  - 토큰을 사용한다면, 그 어떤 디바이스에서도, 그 어떤 도메인에서도, 토큰만 유효하다면 요청이 정상적으로 처리가능
  - `Access-Control-Allow-Origin: *` 만 추가하면 된다.
  - 서버측에서는 오직 API만 다루도록 하도록 설계 할 수도 있다.

## 참고 사이트
https://velopert.com/2350

https://doogle.link/jwt-%ED%98%B9%EC%9D%80-oauth2-%EC%9D%98-refresh-%ED%86%A0%ED%81%B0%EC%9D%84-%EC%96%B4%EB%94%94%EB%8B%A4-%EC%A0%80%EC%9E%A5%ED%95%B4%EC%95%BC-%ED%95%A0%EA%B9%8C/

https://pomo0703.tistory.com/208

https://velog.io/@ehdrms2034/Access-Token-%EC%A0%80%EC%9E%A5-%EC%9C%84%EC%B9%98%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B3%A0%EC%B0%B0